<!DOCTYPE html>
<html>
<head>
  <title>Agnodice</title>
</head>
<style>
table {
  border-collapse: collapse;
}
table, td, th {
  border: 1px solid black;
}
.highlight {
  /*font-weight: bold;*/
  background-color: rgba(255, 153, 0,.31);
}
</style>
<body onload="getData()">
<h1>Agnodice</h1>

<p>Busca: <input type="text" id="txt1" onkeyup="showHint(this.value)"></p>

<p><span id="txtHint"></span></p> 

<script>
function getData() {
  var codes = getTerms("codes.txt");
  var latim = getTerms("terms.la");
  var english = getTerms("terms.en");
  var spanish = getTerms("terms.es");
  terms = new Array(codes.length);
  for (var i=0; i<terms.length; i++) {
    terms[i] = new Array(4);
    terms[i][0] = codes[i];
    terms[i][1] = latim[i];
    terms[i][2] = english[i];
    terms[i][3] = spanish[i];
  }
}

function showHint(str) {
  var list = "<table><tr><th>Code</th><th>Latim</th><th>English</th><th>Spa&ntilde;ol</th></tr>";
  if (str.length > 0) {
    var reg  = "("+str+")(?![^<]*>)";
    var regex = new RegExp(reg, "i");
    var line = "";
    var res, startpos, endpos, text, startswith;
    //*
    for (var i=0; i<terms.length; i++) {
      line = "<tr><td>"+terms[i][0]+"</td><td>"+terms[i][1]+"</td><td>"+terms[i][2]+"</td><td>"+terms[i][3]+"</td></tr>";
      startswith = false;
      for (var j=0; j<4; j++) {
        if (typeof terms[i][j]!=='undefined' && terms[i][j].toLowerCase().startsWith(str.toLowerCase())){
          startswith = true;
          break;
        }
      }
      if (startswith){
        res = line.match(regex);
        startpos = res.index;
        endpos = startpos + res[0].toString().length;
        text = line.substring(startpos, endpos);
        list += line.replace(regex, `<spam class="highlight">${text}</spam>`);
      }
    }//*/
    for (var i=0; i<terms.length; i++) {
      line = "<tr><td>"+terms[i][0]+"</td><td>"+terms[i][1]+"</td><td>"+terms[i][2]+"</td><td>"+terms[i][3]+"</td></tr>";
      startswith = false;
      for (var j=0; j<4; j++) {
        if (typeof terms[i][j]!=='undefined' && terms[i][j].toLowerCase().startsWith(str.toLowerCase())){
          startswith = true;
          break;
        }
      }
      res = line.match(regex);
      if (!startswith && res){
        startpos = res.index;
        endpos = startpos + res[0].toString().length;
        text = line.substring(startpos, endpos);
        list += line.replace(regex, `<spam class="highlight">${text}</spam>`);
      }
    }
  }
  list += "</table>";
  document.getElementById("txtHint").innerHTML = list;
}

function getTerms(file){
  xhttp = new XMLHttpRequest();
  xhttp.open("GET", file, false);
  xhttp.send();
  return xhttp.responseText.split('\n');
}
</script>

</body>
</html>
